{"ast":null,"code":"var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, {\n  enumerable: true,\n  configurable: true,\n  writable: true,\n  value\n}) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\nimport { Vector3, EventDispatcher, Spherical, MathUtils } from \"three\";\nconst targetPosition = new Vector3();\nclass FirstPersonControls extends EventDispatcher {\n  constructor(object, domElement) {\n    super();\n    __publicField(this, \"object\");\n    __publicField(this, \"domElement\");\n    __publicField(this, \"enabled\", true);\n    __publicField(this, \"movementSpeed\", 1);\n    __publicField(this, \"lookSpeed\", 5e-3);\n    __publicField(this, \"lookVertical\", true);\n    __publicField(this, \"autoForward\", false);\n    __publicField(this, \"activeLook\", true);\n    __publicField(this, \"heightSpeed\", false);\n    __publicField(this, \"heightCoef\", 1);\n    __publicField(this, \"heightMin\", 0);\n    __publicField(this, \"heightMax\", 1);\n    __publicField(this, \"constrainVertical\", false);\n    __publicField(this, \"verticalMin\", 0);\n    __publicField(this, \"verticalMax\", Math.PI);\n    __publicField(this, \"mouseDragOn\", false);\n    // internals\n    __publicField(this, \"autoSpeedFactor\", 0);\n    __publicField(this, \"mouseX\", 0);\n    __publicField(this, \"mouseY\", 0);\n    __publicField(this, \"moveForward\", false);\n    __publicField(this, \"moveBackward\", false);\n    __publicField(this, \"moveLeft\", false);\n    __publicField(this, \"moveRight\", false);\n    __publicField(this, \"moveUp\", false);\n    __publicField(this, \"moveDown\", false);\n    __publicField(this, \"viewHalfX\", 0);\n    __publicField(this, \"viewHalfY\", 0);\n    __publicField(this, \"lat\", 0);\n    __publicField(this, \"lon\", 0);\n    __publicField(this, \"lookDirection\", new Vector3());\n    __publicField(this, \"spherical\", new Spherical());\n    __publicField(this, \"target\", new Vector3());\n    __publicField(this, \"connect\", domElement => {\n      domElement.setAttribute(\"tabindex\", \"-1\");\n      domElement.style.touchAction = \"none\";\n      domElement.addEventListener(\"contextmenu\", this.contextmenu);\n      domElement.addEventListener(\"mousemove\", this.onMouseMove);\n      domElement.addEventListener(\"mousedown\", this.onMouseDown);\n      domElement.addEventListener(\"mouseup\", this.onMouseUp);\n      this.domElement = domElement;\n      window.addEventListener(\"keydown\", this.onKeyDown);\n      window.addEventListener(\"keyup\", this.onKeyUp);\n      this.handleResize();\n    });\n    __publicField(this, \"dispose\", () => {\n      var _a, _b, _c, _d;\n      (_a = this.domElement) == null ? void 0 : _a.removeEventListener(\"contextmenu\", this.contextmenu);\n      (_b = this.domElement) == null ? void 0 : _b.removeEventListener(\"mousedown\", this.onMouseDown);\n      (_c = this.domElement) == null ? void 0 : _c.removeEventListener(\"mousemove\", this.onMouseMove);\n      (_d = this.domElement) == null ? void 0 : _d.removeEventListener(\"mouseup\", this.onMouseUp);\n      window.removeEventListener(\"keydown\", this.onKeyDown);\n      window.removeEventListener(\"keyup\", this.onKeyUp);\n    });\n    __publicField(this, \"handleResize\", () => {\n      if (this.domElement) {\n        this.viewHalfX = this.domElement.offsetWidth / 2;\n        this.viewHalfY = this.domElement.offsetHeight / 2;\n      }\n    });\n    __publicField(this, \"onMouseDown\", event => {\n      var _a;\n      (_a = this.domElement) == null ? void 0 : _a.focus();\n      if (this.activeLook) {\n        switch (event.button) {\n          case 0:\n            this.moveForward = true;\n            break;\n          case 2:\n            this.moveBackward = true;\n            break;\n        }\n      }\n      this.mouseDragOn = true;\n    });\n    __publicField(this, \"onMouseUp\", event => {\n      if (this.activeLook) {\n        switch (event.button) {\n          case 0:\n            this.moveForward = false;\n            break;\n          case 2:\n            this.moveBackward = false;\n            break;\n        }\n      }\n      this.mouseDragOn = false;\n    });\n    __publicField(this, \"onMouseMove\", event => {\n      if (this.domElement) {\n        this.mouseX = event.pageX - this.domElement.offsetLeft - this.viewHalfX;\n        this.mouseY = event.pageY - this.domElement.offsetTop - this.viewHalfY;\n      }\n    });\n    __publicField(this, \"onKeyDown\", event => {\n      switch (event.code) {\n        case \"ArrowUp\":\n        case \"KeyW\":\n          this.moveForward = true;\n          break;\n        case \"ArrowLeft\":\n        case \"KeyA\":\n          this.moveLeft = true;\n          break;\n        case \"ArrowDown\":\n        case \"KeyS\":\n          this.moveBackward = true;\n          break;\n        case \"ArrowRight\":\n        case \"KeyD\":\n          this.moveRight = true;\n          break;\n        case \"KeyR\":\n          this.moveUp = true;\n          break;\n        case \"KeyF\":\n          this.moveDown = true;\n          break;\n      }\n    });\n    __publicField(this, \"onKeyUp\", event => {\n      switch (event.code) {\n        case \"ArrowUp\":\n        case \"KeyW\":\n          this.moveForward = false;\n          break;\n        case \"ArrowLeft\":\n        case \"KeyA\":\n          this.moveLeft = false;\n          break;\n        case \"ArrowDown\":\n        case \"KeyS\":\n          this.moveBackward = false;\n          break;\n        case \"ArrowRight\":\n        case \"KeyD\":\n          this.moveRight = false;\n          break;\n        case \"KeyR\":\n          this.moveUp = false;\n          break;\n        case \"KeyF\":\n          this.moveDown = false;\n          break;\n      }\n    });\n    __publicField(this, \"lookAt\", (x, y, z) => {\n      if (x instanceof Vector3) {\n        this.target.copy(x);\n      } else if (y && z) {\n        this.target.set(x, y, z);\n      }\n      this.object.lookAt(this.target);\n      this.setOrientation();\n      return this;\n    });\n    __publicField(this, \"update\", delta => {\n      if (!this.enabled) return;\n      if (this.heightSpeed) {\n        const y = MathUtils.clamp(this.object.position.y, this.heightMin, this.heightMax);\n        const heightDelta = y - this.heightMin;\n        this.autoSpeedFactor = delta * (heightDelta * this.heightCoef);\n      } else {\n        this.autoSpeedFactor = 0;\n      }\n      const actualMoveSpeed = delta * this.movementSpeed;\n      if (this.moveForward || this.autoForward && !this.moveBackward) {\n        this.object.translateZ(-(actualMoveSpeed + this.autoSpeedFactor));\n      }\n      if (this.moveBackward) this.object.translateZ(actualMoveSpeed);\n      if (this.moveLeft) this.object.translateX(-actualMoveSpeed);\n      if (this.moveRight) this.object.translateX(actualMoveSpeed);\n      if (this.moveUp) this.object.translateY(actualMoveSpeed);\n      if (this.moveDown) this.object.translateY(-actualMoveSpeed);\n      let actualLookSpeed = delta * this.lookSpeed;\n      if (!this.activeLook) {\n        actualLookSpeed = 0;\n      }\n      let verticalLookRatio = 1;\n      if (this.constrainVertical) {\n        verticalLookRatio = Math.PI / (this.verticalMax - this.verticalMin);\n      }\n      this.lon -= this.mouseX * actualLookSpeed;\n      if (this.lookVertical) this.lat -= this.mouseY * actualLookSpeed * verticalLookRatio;\n      this.lat = Math.max(-85, Math.min(85, this.lat));\n      let phi = MathUtils.degToRad(90 - this.lat);\n      const theta = MathUtils.degToRad(this.lon);\n      if (this.constrainVertical) {\n        phi = MathUtils.mapLinear(phi, 0, Math.PI, this.verticalMin, this.verticalMax);\n      }\n      const position = this.object.position;\n      targetPosition.setFromSphericalCoords(1, phi, theta).add(position);\n      this.object.lookAt(targetPosition);\n    });\n    __publicField(this, \"contextmenu\", event => event.preventDefault());\n    __publicField(this, \"setOrientation\", () => {\n      this.lookDirection.set(0, 0, -1).applyQuaternion(this.object.quaternion);\n      this.spherical.setFromVector3(this.lookDirection);\n      this.lat = 90 - MathUtils.radToDeg(this.spherical.phi);\n      this.lon = MathUtils.radToDeg(this.spherical.theta);\n    });\n    this.object = object;\n    this.domElement = domElement;\n    this.setOrientation();\n    if (domElement) this.connect(domElement);\n  }\n}\nexport { FirstPersonControls };","map":{"version":3,"sources":["../../src/controls/FirstPersonControls.ts"],"names":[],"mappings":"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","sourcesContent":["import { MathUtils, Spherical, Vector3, EventDispatcher, Camera } from 'three'\n\nconst targetPosition = new Vector3()\n\nexport class FirstPersonControls extends EventDispatcher {\n  public object: Camera\n  public domElement?: HTMLElement | null\n\n  public enabled = true\n\n  public movementSpeed = 1.0\n  public lookSpeed = 0.005\n\n  public lookVertical = true\n  public autoForward = false\n\n  public activeLook = true\n\n  public heightSpeed = false\n  public heightCoef = 1.0\n  public heightMin = 0.0\n  public heightMax = 1.0\n\n  public constrainVertical = false\n  public verticalMin = 0\n  public verticalMax = Math.PI\n\n  public mouseDragOn = false\n\n  // internals\n\n  private autoSpeedFactor = 0.0\n\n  private mouseX = 0\n  private mouseY = 0\n\n  private moveForward = false\n  private moveBackward = false\n  private moveLeft = false\n  private moveRight = false\n  private moveUp = false\n  private moveDown = false\n\n  private viewHalfX = 0\n  private viewHalfY = 0\n\n  private lat = 0\n  private lon = 0\n\n  private lookDirection = new Vector3()\n  private spherical = new Spherical()\n  readonly target = new Vector3()\n\n  constructor(object: Camera, domElement?: HTMLElement | null) {\n    super()\n\n    this.object = object\n    this.domElement = domElement\n\n    this.setOrientation()\n\n    if (domElement) this.connect(domElement)\n  }\n\n  public connect = (domElement: HTMLElement): void => {\n    domElement.setAttribute('tabindex', '-1')\n\n    domElement.style.touchAction = 'none'\n\n    domElement.addEventListener('contextmenu', this.contextmenu)\n    domElement.addEventListener('mousemove', this.onMouseMove)\n    domElement.addEventListener('mousedown', this.onMouseDown)\n    domElement.addEventListener('mouseup', this.onMouseUp)\n\n    this.domElement = domElement\n\n    window.addEventListener('keydown', this.onKeyDown)\n    window.addEventListener('keyup', this.onKeyUp)\n\n    this.handleResize()\n  }\n\n  public dispose = (): void => {\n    this.domElement?.removeEventListener('contextmenu', this.contextmenu)\n    this.domElement?.removeEventListener('mousedown', this.onMouseDown)\n    this.domElement?.removeEventListener('mousemove', this.onMouseMove)\n    this.domElement?.removeEventListener('mouseup', this.onMouseUp)\n\n    window.removeEventListener('keydown', this.onKeyDown)\n    window.removeEventListener('keyup', this.onKeyUp)\n  }\n\n  public handleResize = (): void => {\n    if (this.domElement) {\n      this.viewHalfX = this.domElement.offsetWidth / 2\n      this.viewHalfY = this.domElement.offsetHeight / 2\n    }\n  }\n\n  private onMouseDown = (event: MouseEvent): void => {\n    this.domElement?.focus()\n\n    if (this.activeLook) {\n      switch (event.button) {\n        case 0:\n          this.moveForward = true\n          break\n        case 2:\n          this.moveBackward = true\n          break\n      }\n    }\n\n    this.mouseDragOn = true\n  }\n\n  private onMouseUp = (event: MouseEvent): void => {\n    if (this.activeLook) {\n      switch (event.button) {\n        case 0:\n          this.moveForward = false\n          break\n        case 2:\n          this.moveBackward = false\n          break\n      }\n    }\n\n    this.mouseDragOn = false\n  }\n\n  private onMouseMove = (event: MouseEvent): void => {\n    if (this.domElement) {\n      this.mouseX = event.pageX - this.domElement.offsetLeft - this.viewHalfX\n      this.mouseY = event.pageY - this.domElement.offsetTop - this.viewHalfY\n    }\n  }\n\n  private onKeyDown = (event: KeyboardEvent): void => {\n    switch (event.code) {\n      case 'ArrowUp':\n      case 'KeyW':\n        this.moveForward = true\n        break\n\n      case 'ArrowLeft':\n      case 'KeyA':\n        this.moveLeft = true\n        break\n\n      case 'ArrowDown':\n      case 'KeyS':\n        this.moveBackward = true\n        break\n\n      case 'ArrowRight':\n      case 'KeyD':\n        this.moveRight = true\n        break\n\n      case 'KeyR':\n        this.moveUp = true\n        break\n      case 'KeyF':\n        this.moveDown = true\n        break\n    }\n  }\n\n  private onKeyUp = (event: KeyboardEvent): void => {\n    switch (event.code) {\n      case 'ArrowUp':\n      case 'KeyW':\n        this.moveForward = false\n        break\n\n      case 'ArrowLeft':\n      case 'KeyA':\n        this.moveLeft = false\n        break\n\n      case 'ArrowDown':\n      case 'KeyS':\n        this.moveBackward = false\n        break\n\n      case 'ArrowRight':\n      case 'KeyD':\n        this.moveRight = false\n        break\n\n      case 'KeyR':\n        this.moveUp = false\n        break\n      case 'KeyF':\n        this.moveDown = false\n        break\n    }\n  }\n\n  public lookAt = (x: Vector3 | number, y?: number, z?: number): this => {\n    if (x instanceof Vector3) {\n      this.target.copy(x)\n    } else if (y && z) {\n      this.target.set(x, y, z)\n    }\n\n    this.object.lookAt(this.target)\n\n    this.setOrientation()\n\n    return this\n  }\n\n  public update = (delta: number): void => {\n    if (!this.enabled) return\n\n    if (this.heightSpeed) {\n      const y = MathUtils.clamp(this.object.position.y, this.heightMin, this.heightMax)\n      const heightDelta = y - this.heightMin\n\n      this.autoSpeedFactor = delta * (heightDelta * this.heightCoef)\n    } else {\n      this.autoSpeedFactor = 0.0\n    }\n\n    const actualMoveSpeed = delta * this.movementSpeed\n\n    if (this.moveForward || (this.autoForward && !this.moveBackward)) {\n      this.object.translateZ(-(actualMoveSpeed + this.autoSpeedFactor))\n    }\n    if (this.moveBackward) this.object.translateZ(actualMoveSpeed)\n\n    if (this.moveLeft) this.object.translateX(-actualMoveSpeed)\n    if (this.moveRight) this.object.translateX(actualMoveSpeed)\n\n    if (this.moveUp) this.object.translateY(actualMoveSpeed)\n    if (this.moveDown) this.object.translateY(-actualMoveSpeed)\n\n    let actualLookSpeed = delta * this.lookSpeed\n\n    if (!this.activeLook) {\n      actualLookSpeed = 0\n    }\n\n    let verticalLookRatio = 1\n\n    if (this.constrainVertical) {\n      verticalLookRatio = Math.PI / (this.verticalMax - this.verticalMin)\n    }\n\n    this.lon -= this.mouseX * actualLookSpeed\n    if (this.lookVertical) this.lat -= this.mouseY * actualLookSpeed * verticalLookRatio\n\n    this.lat = Math.max(-85, Math.min(85, this.lat))\n\n    let phi = MathUtils.degToRad(90 - this.lat)\n    const theta = MathUtils.degToRad(this.lon)\n\n    if (this.constrainVertical) {\n      phi = MathUtils.mapLinear(phi, 0, Math.PI, this.verticalMin, this.verticalMax)\n    }\n\n    const position = this.object.position\n\n    targetPosition.setFromSphericalCoords(1, phi, theta).add(position)\n\n    this.object.lookAt(targetPosition)\n  }\n\n  private contextmenu = (event: Event): void => event.preventDefault()\n\n  private setOrientation = (): void => {\n    this.lookDirection.set(0, 0, -1).applyQuaternion(this.object.quaternion)\n    this.spherical.setFromVector3(this.lookDirection)\n    this.lat = 90 - MathUtils.radToDeg(this.spherical.phi)\n    this.lon = MathUtils.radToDeg(this.spherical.theta)\n  }\n}\n"]},"metadata":{},"sourceType":"module"}