{"ast":null,"code":"import { Object3D, Vector2, Vector3, Matrix4 } from \"three\";\nclass CSS2DObject extends Object3D {\n  constructor(element = document.createElement(\"div\")) {\n    super();\n    this.isCSS2DObject = true;\n    this.element = element;\n    this.element.style.position = \"absolute\";\n    this.element.style.userSelect = \"none\";\n    this.element.setAttribute(\"draggable\", false);\n    this.center = new Vector2(0.5, 0.5);\n    this.addEventListener(\"removed\", function () {\n      this.traverse(function (object) {\n        if (object.element instanceof Element && object.element.parentNode !== null) {\n          object.element.parentNode.removeChild(object.element);\n        }\n      });\n    });\n  }\n  copy(source, recursive) {\n    super.copy(source, recursive);\n    this.element = source.element.cloneNode(true);\n    this.center = source.center;\n    return this;\n  }\n}\nconst _vector = new Vector3();\nconst _viewMatrix = new Matrix4();\nconst _viewProjectionMatrix = new Matrix4();\nconst _a = new Vector3();\nconst _b = new Vector3();\nclass CSS2DRenderer {\n  constructor(parameters = {}) {\n    const _this = this;\n    let _width, _height;\n    let _widthHalf, _heightHalf;\n    const cache = {\n      objects: /* @__PURE__ */new WeakMap()\n    };\n    const domElement = parameters.element !== void 0 ? parameters.element : document.createElement(\"div\");\n    domElement.style.overflow = \"hidden\";\n    this.domElement = domElement;\n    this.getSize = function () {\n      return {\n        width: _width,\n        height: _height\n      };\n    };\n    this.render = function (scene, camera) {\n      if (scene.matrixWorldAutoUpdate === true) scene.updateMatrixWorld();\n      if (camera.parent === null && camera.matrixWorldAutoUpdate === true) camera.updateMatrixWorld();\n      _viewMatrix.copy(camera.matrixWorldInverse);\n      _viewProjectionMatrix.multiplyMatrices(camera.projectionMatrix, _viewMatrix);\n      renderObject(scene, scene, camera);\n      zOrder(scene);\n    };\n    this.setSize = function (width, height) {\n      _width = width;\n      _height = height;\n      _widthHalf = _width / 2;\n      _heightHalf = _height / 2;\n      domElement.style.width = width + \"px\";\n      domElement.style.height = height + \"px\";\n    };\n    function renderObject(object, scene, camera) {\n      if (object.isCSS2DObject) {\n        _vector.setFromMatrixPosition(object.matrixWorld);\n        _vector.applyMatrix4(_viewProjectionMatrix);\n        const visible = object.visible === true && _vector.z >= -1 && _vector.z <= 1 && object.layers.test(camera.layers) === true;\n        object.element.style.display = visible === true ? \"\" : \"none\";\n        if (visible === true) {\n          object.onBeforeRender(_this, scene, camera);\n          const element = object.element;\n          element.style.transform = \"translate(\" + -100 * object.center.x + \"%,\" + -100 * object.center.y + \"%)translate(\" + (_vector.x * _widthHalf + _widthHalf) + \"px,\" + (-_vector.y * _heightHalf + _heightHalf) + \"px)\";\n          if (element.parentNode !== domElement) {\n            domElement.appendChild(element);\n          }\n          object.onAfterRender(_this, scene, camera);\n        }\n        const objectData = {\n          distanceToCameraSquared: getDistanceToSquared(camera, object)\n        };\n        cache.objects.set(object, objectData);\n      }\n      for (let i = 0, l = object.children.length; i < l; i++) {\n        renderObject(object.children[i], scene, camera);\n      }\n    }\n    function getDistanceToSquared(object1, object2) {\n      _a.setFromMatrixPosition(object1.matrixWorld);\n      _b.setFromMatrixPosition(object2.matrixWorld);\n      return _a.distanceToSquared(_b);\n    }\n    function filterAndFlatten(scene) {\n      const result = [];\n      scene.traverse(function (object) {\n        if (object.isCSS2DObject) result.push(object);\n      });\n      return result;\n    }\n    function zOrder(scene) {\n      const sorted = filterAndFlatten(scene).sort(function (a, b) {\n        if (a.renderOrder !== b.renderOrder) {\n          return b.renderOrder - a.renderOrder;\n        }\n        const distanceA = cache.objects.get(a).distanceToCameraSquared;\n        const distanceB = cache.objects.get(b).distanceToCameraSquared;\n        return distanceA - distanceB;\n      });\n      const zMax = sorted.length;\n      for (let i = 0, l = sorted.length; i < l; i++) {\n        sorted[i].element.style.zIndex = zMax - i;\n      }\n    }\n  }\n}\nexport { CSS2DObject, CSS2DRenderer };","map":{"version":3,"sources":["../../src/renderers/CSS2DRenderer.js"],"names":[],"mappings":"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","sourcesContent":["import { Matrix4, Object3D, Vector2, Vector3 } from 'three'\n\nclass CSS2DObject extends Object3D {\n  constructor(element = document.createElement('div')) {\n    super()\n\n    this.isCSS2DObject = true\n\n    this.element = element\n\n    this.element.style.position = 'absolute'\n    this.element.style.userSelect = 'none'\n\n    this.element.setAttribute('draggable', false)\n\n    this.center = new Vector2(0.5, 0.5) // ( 0, 0 ) is the lower left; ( 1, 1 ) is the top right\n\n    this.addEventListener('removed', function () {\n      this.traverse(function (object) {\n        if (object.element instanceof Element && object.element.parentNode !== null) {\n          object.element.parentNode.removeChild(object.element)\n        }\n      })\n    })\n  }\n\n  copy(source, recursive) {\n    super.copy(source, recursive)\n\n    this.element = source.element.cloneNode(true)\n\n    this.center = source.center\n\n    return this\n  }\n}\n\nconst _vector = new Vector3()\nconst _viewMatrix = new Matrix4()\nconst _viewProjectionMatrix = new Matrix4()\nconst _a = new Vector3()\nconst _b = new Vector3()\n\nclass CSS2DRenderer {\n  constructor(parameters = {}) {\n    const _this = this\n\n    let _width, _height\n    let _widthHalf, _heightHalf\n\n    const cache = {\n      objects: new WeakMap(),\n    }\n\n    const domElement = parameters.element !== undefined ? parameters.element : document.createElement('div')\n\n    domElement.style.overflow = 'hidden'\n\n    this.domElement = domElement\n\n    this.getSize = function () {\n      return {\n        width: _width,\n        height: _height,\n      }\n    }\n\n    this.render = function (scene, camera) {\n      if (scene.matrixWorldAutoUpdate === true) scene.updateMatrixWorld()\n      if (camera.parent === null && camera.matrixWorldAutoUpdate === true) camera.updateMatrixWorld()\n\n      _viewMatrix.copy(camera.matrixWorldInverse)\n      _viewProjectionMatrix.multiplyMatrices(camera.projectionMatrix, _viewMatrix)\n\n      renderObject(scene, scene, camera)\n      zOrder(scene)\n    }\n\n    this.setSize = function (width, height) {\n      _width = width\n      _height = height\n\n      _widthHalf = _width / 2\n      _heightHalf = _height / 2\n\n      domElement.style.width = width + 'px'\n      domElement.style.height = height + 'px'\n    }\n\n    function renderObject(object, scene, camera) {\n      if (object.isCSS2DObject) {\n        _vector.setFromMatrixPosition(object.matrixWorld)\n        _vector.applyMatrix4(_viewProjectionMatrix)\n\n        const visible =\n          object.visible === true && _vector.z >= -1 && _vector.z <= 1 && object.layers.test(camera.layers) === true\n        object.element.style.display = visible === true ? '' : 'none'\n\n        if (visible === true) {\n          object.onBeforeRender(_this, scene, camera)\n\n          const element = object.element\n\n          element.style.transform =\n            'translate(' +\n            -100 * object.center.x +\n            '%,' +\n            -100 * object.center.y +\n            '%)' +\n            'translate(' +\n            (_vector.x * _widthHalf + _widthHalf) +\n            'px,' +\n            (-_vector.y * _heightHalf + _heightHalf) +\n            'px)'\n\n          if (element.parentNode !== domElement) {\n            domElement.appendChild(element)\n          }\n\n          object.onAfterRender(_this, scene, camera)\n        }\n\n        const objectData = {\n          distanceToCameraSquared: getDistanceToSquared(camera, object),\n        }\n\n        cache.objects.set(object, objectData)\n      }\n\n      for (let i = 0, l = object.children.length; i < l; i++) {\n        renderObject(object.children[i], scene, camera)\n      }\n    }\n\n    function getDistanceToSquared(object1, object2) {\n      _a.setFromMatrixPosition(object1.matrixWorld)\n      _b.setFromMatrixPosition(object2.matrixWorld)\n\n      return _a.distanceToSquared(_b)\n    }\n\n    function filterAndFlatten(scene) {\n      const result = []\n\n      scene.traverse(function (object) {\n        if (object.isCSS2DObject) result.push(object)\n      })\n\n      return result\n    }\n\n    function zOrder(scene) {\n      const sorted = filterAndFlatten(scene).sort(function (a, b) {\n        if (a.renderOrder !== b.renderOrder) {\n          return b.renderOrder - a.renderOrder\n        }\n\n        const distanceA = cache.objects.get(a).distanceToCameraSquared\n        const distanceB = cache.objects.get(b).distanceToCameraSquared\n\n        return distanceA - distanceB\n      })\n\n      const zMax = sorted.length\n\n      for (let i = 0, l = sorted.length; i < l; i++) {\n        sorted[i].element.style.zIndex = zMax - i\n      }\n    }\n  }\n}\n\nexport { CSS2DObject, CSS2DRenderer }\n"]},"metadata":{},"sourceType":"module"}