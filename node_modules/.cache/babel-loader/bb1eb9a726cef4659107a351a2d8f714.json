{"ast":null,"code":"class LWO3Parser {\n  constructor(IFFParser) {\n    this.IFF = IFFParser;\n  }\n  parseBlock() {\n    this.IFF.debugger.offset = this.IFF.reader.offset;\n    this.IFF.debugger.closeForms();\n    const blockID = this.IFF.reader.getIDTag();\n    const length = this.IFF.reader.getUint32();\n    this.IFF.debugger.dataOffset = this.IFF.reader.offset;\n    this.IFF.debugger.length = length;\n    switch (blockID) {\n      case \"FORM\":\n        this.IFF.parseForm(length);\n        break;\n      case \"ICON\":\n      case \"VMPA\":\n      case \"BBOX\":\n      case \"NORM\":\n      case \"PRE \":\n      case \"POST\":\n      case \"KEY \":\n      case \"SPAN\":\n      case \"TIME\":\n      case \"CLRS\":\n      case \"CLRA\":\n      case \"FILT\":\n      case \"DITH\":\n      case \"CONT\":\n      case \"BRIT\":\n      case \"SATR\":\n      case \"HUE \":\n      case \"GAMM\":\n      case \"NEGA\":\n      case \"IFLT\":\n      case \"PFLT\":\n      case \"PROJ\":\n      case \"AXIS\":\n      case \"AAST\":\n      case \"PIXB\":\n      case \"STCK\":\n      case \"VALU\":\n      case \"PNAM\":\n      case \"INAM\":\n      case \"GRST\":\n      case \"GREN\":\n      case \"GRPT\":\n      case \"FKEY\":\n      case \"IKEY\":\n      case \"CSYS\":\n      case \"OPAQ\":\n      case \"CMAP\":\n      case \"NLOC\":\n      case \"NZOM\":\n      case \"NVER\":\n      case \"NSRV\":\n      case \"NCRD\":\n      case \"NMOD\":\n      case \"NSEL\":\n      case \"NPRW\":\n      case \"NPLA\":\n      case \"VERS\":\n      case \"ENUM\":\n      case \"TAG \":\n      case \"CGMD\":\n      case \"CGTY\":\n      case \"CGST\":\n      case \"CGEN\":\n      case \"CGTS\":\n      case \"CGTE\":\n      case \"OSMP\":\n      case \"OMDE\":\n      case \"OUTR\":\n      case \"FLAG\":\n      case \"TRNL\":\n      case \"SHRP\":\n      case \"RFOP\":\n      case \"RSAN\":\n      case \"TROP\":\n      case \"RBLR\":\n      case \"TBLR\":\n      case \"CLRH\":\n      case \"CLRF\":\n      case \"ADTR\":\n      case \"GLOW\":\n      case \"LINE\":\n      case \"ALPH\":\n      case \"VCOL\":\n      case \"ENAB\":\n        this.IFF.debugger.skipped = true;\n        this.IFF.reader.skip(length);\n        break;\n      case \"IPIX\":\n      case \"IMIP\":\n      case \"IMOD\":\n      case \"AMOD\":\n      case \"IINV\":\n      case \"INCR\":\n      case \"IAXS\":\n      case \"IFOT\":\n      case \"ITIM\":\n      case \"IWRL\":\n      case \"IUTI\":\n      case \"IINX\":\n      case \"IINY\":\n      case \"IINZ\":\n      case \"IREF\":\n        if (length === 4) this.IFF.currentNode[blockID] = this.IFF.reader.getInt32();else this.IFF.reader.skip(length);\n        break;\n      case \"OTAG\":\n        this.IFF.parseObjectTag();\n        break;\n      case \"LAYR\":\n        this.IFF.parseLayer(length);\n        break;\n      case \"PNTS\":\n        this.IFF.parsePoints(length);\n        break;\n      case \"VMAP\":\n        this.IFF.parseVertexMapping(length);\n        break;\n      case \"POLS\":\n        this.IFF.parsePolygonList(length);\n        break;\n      case \"TAGS\":\n        this.IFF.parseTagStrings(length);\n        break;\n      case \"PTAG\":\n        this.IFF.parsePolygonTagMapping(length);\n        break;\n      case \"VMAD\":\n        this.IFF.parseVertexMapping(length, true);\n        break;\n      case \"DESC\":\n        this.IFF.currentForm.description = this.IFF.reader.getString();\n        break;\n      case \"TEXT\":\n      case \"CMNT\":\n      case \"NCOM\":\n        this.IFF.currentForm.comment = this.IFF.reader.getString();\n        break;\n      case \"NAME\":\n        this.IFF.currentForm.channelName = this.IFF.reader.getString();\n        break;\n      case \"WRAP\":\n        this.IFF.currentForm.wrap = {\n          w: this.IFF.reader.getUint16(),\n          h: this.IFF.reader.getUint16()\n        };\n        break;\n      case \"IMAG\":\n        const index = this.IFF.reader.getVariableLengthIndex();\n        this.IFF.currentForm.imageIndex = index;\n        break;\n      case \"OREF\":\n        this.IFF.currentForm.referenceObject = this.IFF.reader.getString();\n        break;\n      case \"ROID\":\n        this.IFF.currentForm.referenceObjectID = this.IFF.reader.getUint32();\n        break;\n      case \"SSHN\":\n        this.IFF.currentSurface.surfaceShaderName = this.IFF.reader.getString();\n        break;\n      case \"AOVN\":\n        this.IFF.currentSurface.surfaceCustomAOVName = this.IFF.reader.getString();\n        break;\n      case \"NSTA\":\n        this.IFF.currentForm.disabled = this.IFF.reader.getUint16();\n        break;\n      case \"NRNM\":\n        this.IFF.currentForm.realName = this.IFF.reader.getString();\n        break;\n      case \"NNME\":\n        this.IFF.currentForm.refName = this.IFF.reader.getString();\n        this.IFF.currentSurface.nodes[this.IFF.currentForm.refName] = this.IFF.currentForm;\n        break;\n      case \"INME\":\n        if (!this.IFF.currentForm.nodeName) this.IFF.currentForm.nodeName = [];\n        this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());\n        break;\n      case \"IINN\":\n        if (!this.IFF.currentForm.inputNodeName) this.IFF.currentForm.inputNodeName = [];\n        this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());\n        break;\n      case \"IINM\":\n        if (!this.IFF.currentForm.inputName) this.IFF.currentForm.inputName = [];\n        this.IFF.currentForm.inputName.push(this.IFF.reader.getString());\n        break;\n      case \"IONM\":\n        if (!this.IFF.currentForm.inputOutputName) this.IFF.currentForm.inputOutputName = [];\n        this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());\n        break;\n      case \"FNAM\":\n        this.IFF.currentForm.fileName = this.IFF.reader.getString();\n        break;\n      case \"CHAN\":\n        if (length === 4) this.IFF.currentForm.textureChannel = this.IFF.reader.getIDTag();else this.IFF.reader.skip(length);\n        break;\n      case \"SMAN\":\n        const maxSmoothingAngle = this.IFF.reader.getFloat32();\n        this.IFF.currentSurface.attributes.smooth = maxSmoothingAngle < 0 ? false : true;\n        break;\n      case \"COLR\":\n        this.IFF.currentSurface.attributes.Color = {\n          value: this.IFF.reader.getFloat32Array(3)\n        };\n        this.IFF.reader.skip(2);\n        break;\n      case \"LUMI\":\n        this.IFF.currentSurface.attributes.Luminosity = {\n          value: this.IFF.reader.getFloat32()\n        };\n        this.IFF.reader.skip(2);\n        break;\n      case \"SPEC\":\n        this.IFF.currentSurface.attributes.Specular = {\n          value: this.IFF.reader.getFloat32()\n        };\n        this.IFF.reader.skip(2);\n        break;\n      case \"DIFF\":\n        this.IFF.currentSurface.attributes.Diffuse = {\n          value: this.IFF.reader.getFloat32()\n        };\n        this.IFF.reader.skip(2);\n        break;\n      case \"REFL\":\n        this.IFF.currentSurface.attributes.Reflection = {\n          value: this.IFF.reader.getFloat32()\n        };\n        this.IFF.reader.skip(2);\n        break;\n      case \"GLOS\":\n        this.IFF.currentSurface.attributes.Glossiness = {\n          value: this.IFF.reader.getFloat32()\n        };\n        this.IFF.reader.skip(2);\n        break;\n      case \"TRAN\":\n        this.IFF.currentSurface.attributes.opacity = this.IFF.reader.getFloat32();\n        this.IFF.reader.skip(2);\n        break;\n      case \"BUMP\":\n        this.IFF.currentSurface.attributes.bumpStrength = this.IFF.reader.getFloat32();\n        this.IFF.reader.skip(2);\n        break;\n      case \"SIDE\":\n        this.IFF.currentSurface.attributes.side = this.IFF.reader.getUint16();\n        break;\n      case \"RIMG\":\n        this.IFF.currentSurface.attributes.reflectionMap = this.IFF.reader.getVariableLengthIndex();\n        break;\n      case \"RIND\":\n        this.IFF.currentSurface.attributes.refractiveIndex = this.IFF.reader.getFloat32();\n        this.IFF.reader.skip(2);\n        break;\n      case \"TIMG\":\n        this.IFF.currentSurface.attributes.refractionMap = this.IFF.reader.getVariableLengthIndex();\n        break;\n      case \"IMAP\":\n        this.IFF.currentSurface.attributes.imageMapIndex = this.IFF.reader.getUint32();\n        break;\n      case \"IUVI\":\n        this.IFF.currentNode.UVChannel = this.IFF.reader.getString(length);\n        break;\n      case \"IUTL\":\n        this.IFF.currentNode.widthWrappingMode = this.IFF.reader.getUint32();\n        break;\n      case \"IVTL\":\n        this.IFF.currentNode.heightWrappingMode = this.IFF.reader.getUint32();\n        break;\n      default:\n        this.IFF.parseUnknownCHUNK(blockID, length);\n    }\n    if (blockID != \"FORM\") {\n      this.IFF.debugger.node = 1;\n      this.IFF.debugger.nodeID = blockID;\n      this.IFF.debugger.log();\n    }\n    if (this.IFF.reader.offset >= this.IFF.currentFormEnd) {\n      this.IFF.currentForm = this.IFF.parentForm;\n    }\n  }\n}\nexport { LWO3Parser };","map":{"version":3,"sources":["../../../src/loaders/lwo/LWO3Parser.js"],"names":[],"mappings":"AAAA,MAAM,UAAA,CAAW;EACf,WAAA,CAAY,SAAA,EAAW;IACrB,IAAA,CAAK,GAAA,GAAM,SAAA;EACZ;EAED,UAAA,CAAA,EAAa;IACX,IAAA,CAAK,GAAA,CAAI,QAAA,CAAS,MAAA,GAAS,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,MAAA;IAC3C,IAAA,CAAK,GAAA,CAAI,QAAA,CAAS,UAAA,CAAY,CAAA;IAE9B,MAAM,OAAA,GAAU,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,QAAA,CAAU,CAAA;IAC1C,MAAM,MAAA,GAAS,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;IAE1C,IAAA,CAAK,GAAA,CAAI,QAAA,CAAS,UAAA,GAAa,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,MAAA;IAC/C,IAAA,CAAK,GAAA,CAAI,QAAA,CAAS,MAAA,GAAS,MAAA;IAG3B,QAAQ,OAAA;MACN,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,SAAA,CAAU,MAAM,CAAA;QACzB;MAIF,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MAKL,KAAK,MAAA;MAGL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MAGL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MAGL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MAGL,KAAK,MAAA;MAGL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MAGL,KAAK,MAAA;MAGL,KAAK,MAAA;MACL,KAAK,MAAA;MAIL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MAGL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MAEL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,QAAA,CAAS,OAAA,GAAU,IAAA;QAC5B,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,MAAM,CAAA;QAC3B;MAGF,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;QACH,IAAI,MAAA,KAAW,CAAA,EAAG,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,OAAO,CAAA,GAAI,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,QAAA,CAAU,CAAA,CAAA,KACvE,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,MAAM,CAAA;QAChC;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAgB,CAAA;QACzB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,UAAA,CAAW,MAAM,CAAA;QAC1B;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,MAAM,CAAA;QAC3B;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,kBAAA,CAAmB,MAAM,CAAA;QAClC;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,gBAAA,CAAiB,MAAM,CAAA;QAChC;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,eAAA,CAAgB,MAAM,CAAA;QAC/B;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,sBAAA,CAAuB,MAAM,CAAA;QACtC;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,kBAAA,CAAmB,MAAA,EAAQ,IAAI,CAAA;QACxC;MAGF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,WAAA,GAAc,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAC9D;MAEF,KAAK,MAAA;MACL,KAAK,MAAA;MACL,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,OAAA,GAAU,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAC1D;MAGF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,WAAA,GAAc,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAC9D;MAGF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,IAAA,GAAO;UAAE,CAAA,EAAG,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAS,CAAA;UAAI,CAAA,EAAG,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAA;QAAa,CAAA;QAC9F;MAEF,KAAK,MAAA;QACH,MAAM,KAAA,GAAQ,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,sBAAA,CAAwB,CAAA;QACtD,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,UAAA,GAAa,KAAA;QAClC;MAGF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,eAAA,GAAkB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAClE;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,iBAAA,GAAoB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QACpE;MAGF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,iBAAA,GAAoB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QACvE;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,oBAAA,GAAuB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAC1E;MAGF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,QAAA,GAAW,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAC3D;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,QAAA,GAAW,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAC3D;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,OAAA,GAAU,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAC1D,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,KAAA,CAAM,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,OAAO,CAAA,GAAI,IAAA,CAAK,GAAA,CAAI,WAAA;QACvE;MAGF,KAAK,MAAA;QACH,IAAI,CAAC,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,QAAA,EAAU,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,QAAA,GAAW,EAAE;QACtE,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,QAAA,CAAS,IAAA,CAAK,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAA,CAAW,CAAA;QAC9D;MAEF,KAAK,MAAA;QACH,IAAI,CAAC,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,aAAA,EAAe,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,aAAA,GAAgB,EAAE;QAChF,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,aAAA,CAAc,IAAA,CAAK,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAA,CAAW,CAAA;QACnE;MAEF,KAAK,MAAA;QACH,IAAI,CAAC,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,SAAA,EAAW,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,SAAA,GAAY,EAAE;QACxE,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,SAAA,CAAU,IAAA,CAAK,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAA,CAAW,CAAA;QAC/D;MAEF,KAAK,MAAA;QACH,IAAI,CAAC,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,eAAA,EAAiB,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,eAAA,GAAkB,EAAE;QACpF,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,eAAA,CAAgB,IAAA,CAAK,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAA,CAAW,CAAA;QACrE;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,QAAA,GAAW,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAC3D;MAEF,KAAK,MAAA;QACH,IAAI,MAAA,KAAW,CAAA,EAAG,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,cAAA,GAAiB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,QAAA,CAAU,CAAA,CAAA,KAC7E,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,MAAM,CAAA;QAChC;MAGF,KAAK,MAAA;QACH,MAAM,iBAAA,GAAoB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,UAAA,CAAY,CAAA;QACtD,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,MAAA,GAAS,iBAAA,GAAoB,CAAA,GAAI,KAAA,GAAQ,IAAA;QAC5E;MAGF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,KAAA,GAAQ;UAAE,KAAA,EAAO,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,eAAA,CAAgB,CAAC;QAAG,CAAA;QACxF,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA;QACtB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,UAAA,GAAa;UAAE,KAAA,EAAO,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,UAAA,CAAU;QAAI,CAAA;QACvF,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA;QACtB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,QAAA,GAAW;UAAE,KAAA,EAAO,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,UAAA,CAAU;QAAI,CAAA;QACrF,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA;QACtB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,OAAA,GAAU;UAAE,KAAA,EAAO,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,UAAA,CAAU;QAAI,CAAA;QACpF,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA;QACtB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,UAAA,GAAa;UAAE,KAAA,EAAO,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,UAAA,CAAU;QAAI,CAAA;QACvF,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA;QACtB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,UAAA,GAAa;UAAE,KAAA,EAAO,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,UAAA,CAAU;QAAI,CAAA;QACvF,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA;QACtB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,OAAA,GAAU,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,UAAA,CAAY,CAAA;QACzE,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA;QACtB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,YAAA,GAAe,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,UAAA,CAAY,CAAA;QAC9E,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA;QACtB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,IAAA,GAAO,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QACrE;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,aAAA,GAAgB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,sBAAA,CAAwB,CAAA;QAC3F;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,eAAA,GAAkB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,UAAA,CAAY,CAAA;QACjF,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,IAAA,CAAK,CAAC,CAAA;QACtB;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,aAAA,GAAgB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,sBAAA,CAAwB,CAAA;QAC3F;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,cAAA,CAAe,UAAA,CAAW,aAAA,GAAgB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QAC9E;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,SAAA,GAAY,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAU,MAAM,CAAA;QACjE;MAEF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,iBAAA,GAAoB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QACpE;MACF,KAAK,MAAA;QACH,IAAA,CAAK,GAAA,CAAI,WAAA,CAAY,kBAAA,GAAqB,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,SAAA,CAAW,CAAA;QACrE;MAEF;QACE,IAAA,CAAK,GAAA,CAAI,iBAAA,CAAkB,OAAA,EAAS,MAAM,CAAA;IAC7C;IAED,IAAI,OAAA,IAAW,MAAA,EAAQ;MACrB,IAAA,CAAK,GAAA,CAAI,QAAA,CAAS,IAAA,GAAO,CAAA;MACzB,IAAA,CAAK,GAAA,CAAI,QAAA,CAAS,MAAA,GAAS,OAAA;MAC3B,IAAA,CAAK,GAAA,CAAI,QAAA,CAAS,GAAA,CAAK,CAAA;IACxB;IAED,IAAI,IAAA,CAAK,GAAA,CAAI,MAAA,CAAO,MAAA,IAAU,IAAA,CAAK,GAAA,CAAI,cAAA,EAAgB;MACrD,IAAA,CAAK,GAAA,CAAI,WAAA,GAAc,IAAA,CAAK,GAAA,CAAI,UAAA;IACjC;EACF;AACH","sourcesContent":["class LWO3Parser {\n  constructor(IFFParser) {\n    this.IFF = IFFParser\n  }\n\n  parseBlock() {\n    this.IFF.debugger.offset = this.IFF.reader.offset\n    this.IFF.debugger.closeForms()\n\n    const blockID = this.IFF.reader.getIDTag()\n    const length = this.IFF.reader.getUint32() // size of data in bytes\n\n    this.IFF.debugger.dataOffset = this.IFF.reader.offset\n    this.IFF.debugger.length = length\n\n    // Data types may be found in either LWO2 OR LWO3 spec\n    switch (blockID) {\n      case 'FORM': // form blocks may consist of sub -chunks or sub-forms\n        this.IFF.parseForm(length)\n        break\n\n      // SKIPPED CHUNKS\n      // MISC skipped\n      case 'ICON': // Thumbnail Icon Image\n      case 'VMPA': // Vertex Map Parameter\n      case 'BBOX': // bounding box\n      // case 'VMMD':\n      // case 'VTYP':\n\n      // normal maps can be specified, normally on models imported from other applications. Currently ignored\n      case 'NORM':\n\n      // ENVL FORM skipped\n      case 'PRE ': // Pre-loop behavior for the keyframe\n      case 'POST': // Post-loop behavior for the keyframe\n      case 'KEY ':\n      case 'SPAN':\n\n      // CLIP FORM skipped\n      case 'TIME':\n      case 'CLRS':\n      case 'CLRA':\n      case 'FILT':\n      case 'DITH':\n      case 'CONT':\n      case 'BRIT':\n      case 'SATR':\n      case 'HUE ':\n      case 'GAMM':\n      case 'NEGA':\n      case 'IFLT':\n      case 'PFLT':\n\n      // Image Map Layer skipped\n      case 'PROJ':\n      case 'AXIS':\n      case 'AAST':\n      case 'PIXB':\n      case 'STCK':\n\n      // Procedural Textures skipped\n      case 'VALU':\n\n      // Gradient Textures skipped\n      case 'PNAM':\n      case 'INAM':\n      case 'GRST':\n      case 'GREN':\n      case 'GRPT':\n      case 'FKEY':\n      case 'IKEY':\n\n      // Texture Mapping Form skipped\n      case 'CSYS':\n\n      // Surface CHUNKs skipped\n      case 'OPAQ': // top level 'opacity' checkbox\n      case 'CMAP': // clip map\n\n      // Surface node CHUNKS skipped\n      // These mainly specify the node editor setup in LW\n      case 'NLOC':\n      case 'NZOM':\n      case 'NVER':\n      case 'NSRV':\n      case 'NCRD':\n      case 'NMOD':\n      case 'NSEL':\n      case 'NPRW':\n      case 'NPLA':\n      case 'VERS':\n      case 'ENUM':\n      case 'TAG ':\n\n      // Car Material CHUNKS\n      case 'CGMD':\n      case 'CGTY':\n      case 'CGST':\n      case 'CGEN':\n      case 'CGTS':\n      case 'CGTE':\n      case 'OSMP':\n      case 'OMDE':\n      case 'OUTR':\n      case 'FLAG':\n\n      case 'TRNL':\n      case 'SHRP':\n      case 'RFOP':\n      case 'RSAN':\n      case 'TROP':\n      case 'RBLR':\n      case 'TBLR':\n      case 'CLRH':\n      case 'CLRF':\n      case 'ADTR':\n      case 'GLOW':\n      case 'LINE':\n      case 'ALPH':\n      case 'VCOL':\n      case 'ENAB':\n        this.IFF.debugger.skipped = true\n        this.IFF.reader.skip(length)\n        break\n\n      // Texture node chunks (not in spec)\n      case 'IPIX': // usePixelBlending\n      case 'IMIP': // useMipMaps\n      case 'IMOD': // imageBlendingMode\n      case 'AMOD': // unknown\n      case 'IINV': // imageInvertAlpha\n      case 'INCR': // imageInvertColor\n      case 'IAXS': // imageAxis ( for non-UV maps)\n      case 'IFOT': // imageFallofType\n      case 'ITIM': // timing for animated textures\n      case 'IWRL':\n      case 'IUTI':\n      case 'IINX':\n      case 'IINY':\n      case 'IINZ':\n      case 'IREF': // possibly a VX for reused texture nodes\n        if (length === 4) this.IFF.currentNode[blockID] = this.IFF.reader.getInt32()\n        else this.IFF.reader.skip(length)\n        break\n\n      case 'OTAG':\n        this.IFF.parseObjectTag()\n        break\n\n      case 'LAYR':\n        this.IFF.parseLayer(length)\n        break\n\n      case 'PNTS':\n        this.IFF.parsePoints(length)\n        break\n\n      case 'VMAP':\n        this.IFF.parseVertexMapping(length)\n        break\n\n      case 'POLS':\n        this.IFF.parsePolygonList(length)\n        break\n\n      case 'TAGS':\n        this.IFF.parseTagStrings(length)\n        break\n\n      case 'PTAG':\n        this.IFF.parsePolygonTagMapping(length)\n        break\n\n      case 'VMAD':\n        this.IFF.parseVertexMapping(length, true)\n        break\n\n      // Misc CHUNKS\n      case 'DESC': // Description Line\n        this.IFF.currentForm.description = this.IFF.reader.getString()\n        break\n\n      case 'TEXT':\n      case 'CMNT':\n      case 'NCOM':\n        this.IFF.currentForm.comment = this.IFF.reader.getString()\n        break\n\n      // Envelope Form\n      case 'NAME':\n        this.IFF.currentForm.channelName = this.IFF.reader.getString()\n        break\n\n      // Image Map Layer\n      case 'WRAP':\n        this.IFF.currentForm.wrap = { w: this.IFF.reader.getUint16(), h: this.IFF.reader.getUint16() }\n        break\n\n      case 'IMAG':\n        const index = this.IFF.reader.getVariableLengthIndex()\n        this.IFF.currentForm.imageIndex = index\n        break\n\n      // Texture Mapping Form\n      case 'OREF':\n        this.IFF.currentForm.referenceObject = this.IFF.reader.getString()\n        break\n\n      case 'ROID':\n        this.IFF.currentForm.referenceObjectID = this.IFF.reader.getUint32()\n        break\n\n      // Surface Blocks\n      case 'SSHN':\n        this.IFF.currentSurface.surfaceShaderName = this.IFF.reader.getString()\n        break\n\n      case 'AOVN':\n        this.IFF.currentSurface.surfaceCustomAOVName = this.IFF.reader.getString()\n        break\n\n      // Nodal Blocks\n      case 'NSTA':\n        this.IFF.currentForm.disabled = this.IFF.reader.getUint16()\n        break\n\n      case 'NRNM':\n        this.IFF.currentForm.realName = this.IFF.reader.getString()\n        break\n\n      case 'NNME':\n        this.IFF.currentForm.refName = this.IFF.reader.getString()\n        this.IFF.currentSurface.nodes[this.IFF.currentForm.refName] = this.IFF.currentForm\n        break\n\n      // Nodal Blocks : connections\n      case 'INME':\n        if (!this.IFF.currentForm.nodeName) this.IFF.currentForm.nodeName = []\n        this.IFF.currentForm.nodeName.push(this.IFF.reader.getString())\n        break\n\n      case 'IINN':\n        if (!this.IFF.currentForm.inputNodeName) this.IFF.currentForm.inputNodeName = []\n        this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString())\n        break\n\n      case 'IINM':\n        if (!this.IFF.currentForm.inputName) this.IFF.currentForm.inputName = []\n        this.IFF.currentForm.inputName.push(this.IFF.reader.getString())\n        break\n\n      case 'IONM':\n        if (!this.IFF.currentForm.inputOutputName) this.IFF.currentForm.inputOutputName = []\n        this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString())\n        break\n\n      case 'FNAM':\n        this.IFF.currentForm.fileName = this.IFF.reader.getString()\n        break\n\n      case 'CHAN': // NOTE: ENVL Forms may also have CHAN chunk, however ENVL is currently ignored\n        if (length === 4) this.IFF.currentForm.textureChannel = this.IFF.reader.getIDTag()\n        else this.IFF.reader.skip(length)\n        break\n\n      // LWO2 Spec chunks: these are needed since the SURF FORMs are often in LWO2 format\n      case 'SMAN':\n        const maxSmoothingAngle = this.IFF.reader.getFloat32()\n        this.IFF.currentSurface.attributes.smooth = maxSmoothingAngle < 0 ? false : true\n        break\n\n      // LWO2: Basic Surface Parameters\n      case 'COLR':\n        this.IFF.currentSurface.attributes.Color = { value: this.IFF.reader.getFloat32Array(3) }\n        this.IFF.reader.skip(2) // VX: envelope\n        break\n\n      case 'LUMI':\n        this.IFF.currentSurface.attributes.Luminosity = { value: this.IFF.reader.getFloat32() }\n        this.IFF.reader.skip(2)\n        break\n\n      case 'SPEC':\n        this.IFF.currentSurface.attributes.Specular = { value: this.IFF.reader.getFloat32() }\n        this.IFF.reader.skip(2)\n        break\n\n      case 'DIFF':\n        this.IFF.currentSurface.attributes.Diffuse = { value: this.IFF.reader.getFloat32() }\n        this.IFF.reader.skip(2)\n        break\n\n      case 'REFL':\n        this.IFF.currentSurface.attributes.Reflection = { value: this.IFF.reader.getFloat32() }\n        this.IFF.reader.skip(2)\n        break\n\n      case 'GLOS':\n        this.IFF.currentSurface.attributes.Glossiness = { value: this.IFF.reader.getFloat32() }\n        this.IFF.reader.skip(2)\n        break\n\n      case 'TRAN':\n        this.IFF.currentSurface.attributes.opacity = this.IFF.reader.getFloat32()\n        this.IFF.reader.skip(2)\n        break\n\n      case 'BUMP':\n        this.IFF.currentSurface.attributes.bumpStrength = this.IFF.reader.getFloat32()\n        this.IFF.reader.skip(2)\n        break\n\n      case 'SIDE':\n        this.IFF.currentSurface.attributes.side = this.IFF.reader.getUint16()\n        break\n\n      case 'RIMG':\n        this.IFF.currentSurface.attributes.reflectionMap = this.IFF.reader.getVariableLengthIndex()\n        break\n\n      case 'RIND':\n        this.IFF.currentSurface.attributes.refractiveIndex = this.IFF.reader.getFloat32()\n        this.IFF.reader.skip(2)\n        break\n\n      case 'TIMG':\n        this.IFF.currentSurface.attributes.refractionMap = this.IFF.reader.getVariableLengthIndex()\n        break\n\n      case 'IMAP':\n        this.IFF.currentSurface.attributes.imageMapIndex = this.IFF.reader.getUint32()\n        break\n\n      case 'IUVI': // uv channel name\n        this.IFF.currentNode.UVChannel = this.IFF.reader.getString(length)\n        break\n\n      case 'IUTL': // widthWrappingMode: 0 = Reset, 1 = Repeat, 2 = Mirror, 3 = Edge\n        this.IFF.currentNode.widthWrappingMode = this.IFF.reader.getUint32()\n        break\n      case 'IVTL': // heightWrappingMode\n        this.IFF.currentNode.heightWrappingMode = this.IFF.reader.getUint32()\n        break\n\n      default:\n        this.IFF.parseUnknownCHUNK(blockID, length)\n    }\n\n    if (blockID != 'FORM') {\n      this.IFF.debugger.node = 1\n      this.IFF.debugger.nodeID = blockID\n      this.IFF.debugger.log()\n    }\n\n    if (this.IFF.reader.offset >= this.IFF.currentFormEnd) {\n      this.IFF.currentForm = this.IFF.parentForm\n    }\n  }\n}\n\nexport { LWO3Parser }\n"]},"metadata":{},"sourceType":"module"}