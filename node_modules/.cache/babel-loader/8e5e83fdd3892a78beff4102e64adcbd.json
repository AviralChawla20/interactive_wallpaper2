{"ast":null,"code":"import { Vector3, Quaternion, Object3D, Matrix4 } from \"three\";\nconst _position = new Vector3();\nconst _quaternion = new Quaternion();\nconst _scale = new Vector3();\nclass CSS3DObject extends Object3D {\n  constructor(element = document.createElement(\"div\")) {\n    super();\n    this.isCSS3DObject = true;\n    this.element = element;\n    this.element.style.position = \"absolute\";\n    this.element.style.pointerEvents = \"auto\";\n    this.element.style.userSelect = \"none\";\n    this.element.setAttribute(\"draggable\", false);\n    this.addEventListener(\"removed\", function () {\n      this.traverse(function (object) {\n        if (object.element instanceof Element && object.element.parentNode !== null) {\n          object.element.parentNode.removeChild(object.element);\n        }\n      });\n    });\n  }\n  copy(source, recursive) {\n    super.copy(source, recursive);\n    this.element = source.element.cloneNode(true);\n    return this;\n  }\n}\nclass CSS3DSprite extends CSS3DObject {\n  constructor(element) {\n    super(element);\n    this.isCSS3DSprite = true;\n    this.rotation2D = 0;\n  }\n  copy(source, recursive) {\n    super.copy(source, recursive);\n    this.rotation2D = source.rotation2D;\n    return this;\n  }\n}\nconst _matrix = new Matrix4();\nconst _matrix2 = new Matrix4();\nclass CSS3DRenderer {\n  constructor(parameters = {}) {\n    const _this = this;\n    let _width, _height;\n    let _widthHalf, _heightHalf;\n    const cache = {\n      camera: {\n        style: \"\"\n      },\n      objects: /* @__PURE__ */new WeakMap()\n    };\n    const domElement = parameters.element !== void 0 ? parameters.element : document.createElement(\"div\");\n    domElement.style.overflow = \"hidden\";\n    this.domElement = domElement;\n    const viewElement = document.createElement(\"div\");\n    viewElement.style.transformOrigin = \"0 0\";\n    viewElement.style.pointerEvents = \"none\";\n    domElement.appendChild(viewElement);\n    const cameraElement = document.createElement(\"div\");\n    cameraElement.style.transformStyle = \"preserve-3d\";\n    viewElement.appendChild(cameraElement);\n    this.getSize = function () {\n      return {\n        width: _width,\n        height: _height\n      };\n    };\n    this.render = function (scene, camera) {\n      const fov = camera.projectionMatrix.elements[5] * _heightHalf;\n      if (camera.view && camera.view.enabled) {\n        viewElement.style.transform = `translate( ${-camera.view.offsetX * (_width / camera.view.width)}px, ${-camera.view.offsetY * (_height / camera.view.height)}px )`;\n        viewElement.style.transform += `scale( ${camera.view.fullWidth / camera.view.width}, ${camera.view.fullHeight / camera.view.height} )`;\n      } else {\n        viewElement.style.transform = \"\";\n      }\n      if (scene.matrixWorldAutoUpdate === true) scene.updateMatrixWorld();\n      if (camera.parent === null && camera.matrixWorldAutoUpdate === true) camera.updateMatrixWorld();\n      let tx, ty;\n      if (camera.isOrthographicCamera) {\n        tx = -(camera.right + camera.left) / 2;\n        ty = (camera.top + camera.bottom) / 2;\n      }\n      const scaleByViewOffset = camera.view && camera.view.enabled ? camera.view.height / camera.view.fullHeight : 1;\n      const cameraCSSMatrix = camera.isOrthographicCamera ? `scale( ${scaleByViewOffset} )scale(` + fov + \")translate(\" + epsilon(tx) + \"px,\" + epsilon(ty) + \"px)\" + getCameraCSSMatrix(camera.matrixWorldInverse) : `scale( ${scaleByViewOffset} )translateZ(` + fov + \"px)\" + getCameraCSSMatrix(camera.matrixWorldInverse);\n      const perspective = camera.isPerspectiveCamera ? \"perspective(\" + fov + \"px) \" : \"\";\n      const style = perspective + cameraCSSMatrix + \"translate(\" + _widthHalf + \"px,\" + _heightHalf + \"px)\";\n      if (cache.camera.style !== style) {\n        cameraElement.style.transform = style;\n        cache.camera.style = style;\n      }\n      renderObject(scene, scene, camera);\n    };\n    this.setSize = function (width, height) {\n      _width = width;\n      _height = height;\n      _widthHalf = _width / 2;\n      _heightHalf = _height / 2;\n      domElement.style.width = width + \"px\";\n      domElement.style.height = height + \"px\";\n      viewElement.style.width = width + \"px\";\n      viewElement.style.height = height + \"px\";\n      cameraElement.style.width = width + \"px\";\n      cameraElement.style.height = height + \"px\";\n    };\n    function epsilon(value) {\n      return Math.abs(value) < 1e-10 ? 0 : value;\n    }\n    function getCameraCSSMatrix(matrix) {\n      const elements = matrix.elements;\n      return \"matrix3d(\" + epsilon(elements[0]) + \",\" + epsilon(-elements[1]) + \",\" + epsilon(elements[2]) + \",\" + epsilon(elements[3]) + \",\" + epsilon(elements[4]) + \",\" + epsilon(-elements[5]) + \",\" + epsilon(elements[6]) + \",\" + epsilon(elements[7]) + \",\" + epsilon(elements[8]) + \",\" + epsilon(-elements[9]) + \",\" + epsilon(elements[10]) + \",\" + epsilon(elements[11]) + \",\" + epsilon(elements[12]) + \",\" + epsilon(-elements[13]) + \",\" + epsilon(elements[14]) + \",\" + epsilon(elements[15]) + \")\";\n    }\n    function getObjectCSSMatrix(matrix) {\n      const elements = matrix.elements;\n      const matrix3d = \"matrix3d(\" + epsilon(elements[0]) + \",\" + epsilon(elements[1]) + \",\" + epsilon(elements[2]) + \",\" + epsilon(elements[3]) + \",\" + epsilon(-elements[4]) + \",\" + epsilon(-elements[5]) + \",\" + epsilon(-elements[6]) + \",\" + epsilon(-elements[7]) + \",\" + epsilon(elements[8]) + \",\" + epsilon(elements[9]) + \",\" + epsilon(elements[10]) + \",\" + epsilon(elements[11]) + \",\" + epsilon(elements[12]) + \",\" + epsilon(elements[13]) + \",\" + epsilon(elements[14]) + \",\" + epsilon(elements[15]) + \")\";\n      return \"translate(-50%,-50%)\" + matrix3d;\n    }\n    function renderObject(object, scene, camera, cameraCSSMatrix) {\n      if (object.isCSS3DObject) {\n        const visible = object.visible === true && object.layers.test(camera.layers) === true;\n        object.element.style.display = visible === true ? \"\" : \"none\";\n        if (visible === true) {\n          object.onBeforeRender(_this, scene, camera);\n          let style;\n          if (object.isCSS3DSprite) {\n            _matrix.copy(camera.matrixWorldInverse);\n            _matrix.transpose();\n            if (object.rotation2D !== 0) _matrix.multiply(_matrix2.makeRotationZ(object.rotation2D));\n            object.matrixWorld.decompose(_position, _quaternion, _scale);\n            _matrix.setPosition(_position);\n            _matrix.scale(_scale);\n            _matrix.elements[3] = 0;\n            _matrix.elements[7] = 0;\n            _matrix.elements[11] = 0;\n            _matrix.elements[15] = 1;\n            style = getObjectCSSMatrix(_matrix);\n          } else {\n            style = getObjectCSSMatrix(object.matrixWorld);\n          }\n          const element = object.element;\n          const cachedObject = cache.objects.get(object);\n          if (cachedObject === void 0 || cachedObject.style !== style) {\n            element.style.transform = style;\n            const objectData = {\n              style\n            };\n            cache.objects.set(object, objectData);\n          }\n          if (element.parentNode !== cameraElement) {\n            cameraElement.appendChild(element);\n          }\n          object.onAfterRender(_this, scene, camera);\n        }\n      }\n      for (let i = 0, l = object.children.length; i < l; i++) {\n        renderObject(object.children[i], scene, camera);\n      }\n    }\n  }\n}\nexport { CSS3DObject, CSS3DRenderer, CSS3DSprite };","map":{"version":3,"sources":["../../src/renderers/CSS3DRenderer.js"],"names":[],"mappings":"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","sourcesContent":["import { Matrix4, Object3D, Quaternion, Vector3 } from 'three'\n\n/**\n * Based on http://www.emagix.net/academic/mscs-project/item/camera-sync-with-css3-and-webgl-threejs\n */\n\nconst _position = new Vector3()\nconst _quaternion = new Quaternion()\nconst _scale = new Vector3()\n\nclass CSS3DObject extends Object3D {\n  constructor(element = document.createElement('div')) {\n    super()\n\n    this.isCSS3DObject = true\n\n    this.element = element\n    this.element.style.position = 'absolute'\n    this.element.style.pointerEvents = 'auto'\n    this.element.style.userSelect = 'none'\n\n    this.element.setAttribute('draggable', false)\n\n    this.addEventListener('removed', function () {\n      this.traverse(function (object) {\n        if (object.element instanceof Element && object.element.parentNode !== null) {\n          object.element.parentNode.removeChild(object.element)\n        }\n      })\n    })\n  }\n\n  copy(source, recursive) {\n    super.copy(source, recursive)\n\n    this.element = source.element.cloneNode(true)\n\n    return this\n  }\n}\n\nclass CSS3DSprite extends CSS3DObject {\n  constructor(element) {\n    super(element)\n\n    this.isCSS3DSprite = true\n\n    this.rotation2D = 0\n  }\n\n  copy(source, recursive) {\n    super.copy(source, recursive)\n\n    this.rotation2D = source.rotation2D\n\n    return this\n  }\n}\n\n//\n\nconst _matrix = new Matrix4()\nconst _matrix2 = new Matrix4()\n\nclass CSS3DRenderer {\n  constructor(parameters = {}) {\n    const _this = this\n\n    let _width, _height\n    let _widthHalf, _heightHalf\n\n    const cache = {\n      camera: { style: '' },\n      objects: new WeakMap(),\n    }\n\n    const domElement = parameters.element !== undefined ? parameters.element : document.createElement('div')\n\n    domElement.style.overflow = 'hidden'\n\n    this.domElement = domElement\n\n    const viewElement = document.createElement('div')\n    viewElement.style.transformOrigin = '0 0'\n    viewElement.style.pointerEvents = 'none'\n    domElement.appendChild(viewElement)\n\n    const cameraElement = document.createElement('div')\n\n    cameraElement.style.transformStyle = 'preserve-3d'\n\n    viewElement.appendChild(cameraElement)\n\n    this.getSize = function () {\n      return {\n        width: _width,\n        height: _height,\n      }\n    }\n\n    this.render = function (scene, camera) {\n      const fov = camera.projectionMatrix.elements[5] * _heightHalf\n\n      if (camera.view && camera.view.enabled) {\n        // view offset\n        viewElement.style.transform = `translate( ${-camera.view.offsetX * (_width / camera.view.width)}px, ${\n          -camera.view.offsetY * (_height / camera.view.height)\n        }px )`\n\n        // view fullWidth and fullHeight, view width and height\n        viewElement.style.transform += `scale( ${camera.view.fullWidth / camera.view.width}, ${\n          camera.view.fullHeight / camera.view.height\n        } )`\n      } else {\n        viewElement.style.transform = ''\n      }\n\n      if (scene.matrixWorldAutoUpdate === true) scene.updateMatrixWorld()\n      if (camera.parent === null && camera.matrixWorldAutoUpdate === true) camera.updateMatrixWorld()\n\n      let tx, ty\n\n      if (camera.isOrthographicCamera) {\n        tx = -(camera.right + camera.left) / 2\n        ty = (camera.top + camera.bottom) / 2\n      }\n\n      const scaleByViewOffset = camera.view && camera.view.enabled ? camera.view.height / camera.view.fullHeight : 1\n      const cameraCSSMatrix = camera.isOrthographicCamera\n        ? `scale( ${scaleByViewOffset} )` +\n          'scale(' +\n          fov +\n          ')' +\n          'translate(' +\n          epsilon(tx) +\n          'px,' +\n          epsilon(ty) +\n          'px)' +\n          getCameraCSSMatrix(camera.matrixWorldInverse)\n        : `scale( ${scaleByViewOffset} )` + 'translateZ(' + fov + 'px)' + getCameraCSSMatrix(camera.matrixWorldInverse)\n      const perspective = camera.isPerspectiveCamera ? 'perspective(' + fov + 'px) ' : ''\n\n      const style = perspective + cameraCSSMatrix + 'translate(' + _widthHalf + 'px,' + _heightHalf + 'px)'\n\n      if (cache.camera.style !== style) {\n        cameraElement.style.transform = style\n\n        cache.camera.style = style\n      }\n\n      renderObject(scene, scene, camera, cameraCSSMatrix)\n    }\n\n    this.setSize = function (width, height) {\n      _width = width\n      _height = height\n      _widthHalf = _width / 2\n      _heightHalf = _height / 2\n\n      domElement.style.width = width + 'px'\n      domElement.style.height = height + 'px'\n\n      viewElement.style.width = width + 'px'\n      viewElement.style.height = height + 'px'\n\n      cameraElement.style.width = width + 'px'\n      cameraElement.style.height = height + 'px'\n    }\n\n    function epsilon(value) {\n      return Math.abs(value) < 1e-10 ? 0 : value\n    }\n\n    function getCameraCSSMatrix(matrix) {\n      const elements = matrix.elements\n\n      return (\n        'matrix3d(' +\n        epsilon(elements[0]) +\n        ',' +\n        epsilon(-elements[1]) +\n        ',' +\n        epsilon(elements[2]) +\n        ',' +\n        epsilon(elements[3]) +\n        ',' +\n        epsilon(elements[4]) +\n        ',' +\n        epsilon(-elements[5]) +\n        ',' +\n        epsilon(elements[6]) +\n        ',' +\n        epsilon(elements[7]) +\n        ',' +\n        epsilon(elements[8]) +\n        ',' +\n        epsilon(-elements[9]) +\n        ',' +\n        epsilon(elements[10]) +\n        ',' +\n        epsilon(elements[11]) +\n        ',' +\n        epsilon(elements[12]) +\n        ',' +\n        epsilon(-elements[13]) +\n        ',' +\n        epsilon(elements[14]) +\n        ',' +\n        epsilon(elements[15]) +\n        ')'\n      )\n    }\n\n    function getObjectCSSMatrix(matrix) {\n      const elements = matrix.elements\n      const matrix3d =\n        'matrix3d(' +\n        epsilon(elements[0]) +\n        ',' +\n        epsilon(elements[1]) +\n        ',' +\n        epsilon(elements[2]) +\n        ',' +\n        epsilon(elements[3]) +\n        ',' +\n        epsilon(-elements[4]) +\n        ',' +\n        epsilon(-elements[5]) +\n        ',' +\n        epsilon(-elements[6]) +\n        ',' +\n        epsilon(-elements[7]) +\n        ',' +\n        epsilon(elements[8]) +\n        ',' +\n        epsilon(elements[9]) +\n        ',' +\n        epsilon(elements[10]) +\n        ',' +\n        epsilon(elements[11]) +\n        ',' +\n        epsilon(elements[12]) +\n        ',' +\n        epsilon(elements[13]) +\n        ',' +\n        epsilon(elements[14]) +\n        ',' +\n        epsilon(elements[15]) +\n        ')'\n\n      return 'translate(-50%,-50%)' + matrix3d\n    }\n\n    function renderObject(object, scene, camera, cameraCSSMatrix) {\n      if (object.isCSS3DObject) {\n        const visible = object.visible === true && object.layers.test(camera.layers) === true\n        object.element.style.display = visible === true ? '' : 'none'\n\n        if (visible === true) {\n          object.onBeforeRender(_this, scene, camera)\n\n          let style\n\n          if (object.isCSS3DSprite) {\n            // http://swiftcoder.wordpress.com/2008/11/25/constructing-a-billboard-matrix/\n\n            _matrix.copy(camera.matrixWorldInverse)\n            _matrix.transpose()\n\n            if (object.rotation2D !== 0) _matrix.multiply(_matrix2.makeRotationZ(object.rotation2D))\n\n            object.matrixWorld.decompose(_position, _quaternion, _scale)\n            _matrix.setPosition(_position)\n            _matrix.scale(_scale)\n\n            _matrix.elements[3] = 0\n            _matrix.elements[7] = 0\n            _matrix.elements[11] = 0\n            _matrix.elements[15] = 1\n\n            style = getObjectCSSMatrix(_matrix)\n          } else {\n            style = getObjectCSSMatrix(object.matrixWorld)\n          }\n\n          const element = object.element\n          const cachedObject = cache.objects.get(object)\n\n          if (cachedObject === undefined || cachedObject.style !== style) {\n            element.style.transform = style\n\n            const objectData = { style: style }\n            cache.objects.set(object, objectData)\n          }\n\n          if (element.parentNode !== cameraElement) {\n            cameraElement.appendChild(element)\n          }\n\n          object.onAfterRender(_this, scene, camera)\n        }\n      }\n\n      for (let i = 0, l = object.children.length; i < l; i++) {\n        renderObject(object.children[i], scene, camera, cameraCSSMatrix)\n      }\n    }\n  }\n}\n\nexport { CSS3DObject, CSS3DSprite, CSS3DRenderer }\n"]},"metadata":{},"sourceType":"module"}